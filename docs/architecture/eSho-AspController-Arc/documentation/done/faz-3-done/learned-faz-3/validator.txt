AÅŸaÄŸÄ±daki notu direkt dokÃ¼mantasyonuna koyabilirsin. â€œValidationBehavior nasÄ±l CreateProductValidatorâ€™Ä± buluyor?â€ sorusunu en sade ve net haliyle anlatÄ±yor.

---

## Not: `ValidationBehavior` iÃ§indeyken `CreateProductValidator` nasÄ±l â€œkendiliÄŸindenâ€ Ã§alÄ±ÅŸÄ±yor?

### KÄ±sa cevap

`ValidationBehavior` **CreateProductValidatorâ€™Ä± hiÃ§ tanÄ±maz**.
Ama **DI (Dependency Injection) container** onu `IValidator<CreateProductCommand>` olarak kaydettiÄŸi iÃ§in, MediatR `Send(CreateProductCommand)` Ã§alÄ±ÅŸtÄ±rÄ±rken `ValidationBehavior`â€™a otomatik **enjekte eder**. Behavior da elindeki tÃ¼m validatorâ€™larÄ± `ValidateAsync` ile Ã§alÄ±ÅŸtÄ±rÄ±r.

---

## 1) Bu otomatikliÄŸi saÄŸlayan ÅŸey ne?

Ä°ki ayrÄ± kayÄ±t var ve ikisi birlikte â€œmagicâ€i oluÅŸturuyor:

### A) FluentValidation tarafÄ± (Validator kayÄ±tlarÄ±)

Genelde ÅŸunu yapÄ±yoruz:

```csharp
builder.Services.AddValidatorsFromAssembly(typeof(Program).Assembly);
```

Bu satÄ±r ÅŸunu yapar:

* Assembly iÃ§inde `AbstractValidator<T>` tÃ¼revlerini arar
* Mesela ÅŸunu bulur:

```csharp
public class CreateProductValidator : AbstractValidator<CreateProductCommand>
```

* Ve DI containerâ€™a ÅŸuna eÅŸdeÄŸer ÅŸekilde kaydeder:

```csharp
services.AddScoped<IValidator<CreateProductCommand>, CreateProductValidator>();
```

âœ… SonuÃ§: DI artÄ±k `IValidator<CreateProductCommand>` istenirse `CreateProductValidator` dÃ¶ndÃ¼rebilir.

---

### B) MediatR tarafÄ± (Behavior kayÄ±tlarÄ±)

Åunu yaptÄ±k:

```csharp
cfg.AddBehavior(typeof(IPipelineBehavior<,>), typeof(ValidationBehavior<,>));
```

Bu kayÄ±t sayesinde MediatR her `Send()` Ã§aÄŸrÄ±sÄ±nda pipeline oluÅŸtururken `ValidationBehavior<TRequest,TResponse>`â€™Ä± da zincire dahil eder.

âœ… SonuÃ§: Her request iÃ§in MediatR, ilgili generic tiplerle behavior instanceâ€™Ä±nÄ± DIâ€™dan Ã§Ã¶zer.

---

## 2) â€œTam olarak ne zamanâ€ CreateProductValidator geliyor?

Åu anda istek gÃ¶nderiliyor:

```csharp
await _mediator.Send(new CreateProductCommand(...));
```

Bu anda:

* `TRequest = CreateProductCommand`
* `TResponse = Guid` (Ã¶rnek)

MediatR pipeline kurarken DIâ€™dan ÅŸunu ister:

* `IPipelineBehavior<CreateProductCommand, Guid>`

  * bu da `ValidationBehavior<CreateProductCommand, Guid>` demektir.

DI, `ValidationBehavior`â€™Ä± oluÅŸtururken constructorâ€™a bakar:

```csharp
public ValidationBehavior(IEnumerable<IValidator<TRequest>> validators)
```

Burada `TRequest = CreateProductCommand` olduÄŸuna gÃ¶re DI ÅŸu listeyi Ã¼retmek zorunda:

ğŸ‘‰ `IEnumerable<IValidator<CreateProductCommand>>`

DI containerâ€™da daha Ã¶nce ÅŸunu kayÄ±t etmiÅŸtik:

* `IValidator<CreateProductCommand> -> CreateProductValidator`

O yÃ¼zden `_validators` listesi iÃ§inde **CreateProductValidator** gelir.

---

## 3) ValidationBehavior o validatorâ€™Ä± nasÄ±l Ã§alÄ±ÅŸtÄ±rÄ±yor?

Behavior iÃ§indeki ÅŸu satÄ±r:

```csharp
_validators.Select(v => v.ValidateAsync(context, cancellationToken))
```

`_validators` iÃ§inde `CreateProductValidator` olduÄŸu iÃ§in ÅŸu Ã§alÄ±ÅŸmÄ±ÅŸ olur:

```csharp
createProductValidator.ValidateAsync(context, cancellationToken);
```

Ve validatorâ€™Ä±n constructorâ€™Ä±nda yazdÄ±ÄŸÄ±n:

```csharp
RuleFor(x => x.Name).NotEmpty()...
RuleFor(x => x.Price).GreaterThan(0)...
RuleFor(x => x.CategoryId).NotEmpty()...
```

kurallarÄ± iÅŸletilir.

---

## 4) Neden ValidationBehavior â€œhangi validatorâ€ olduÄŸunu bilmek zorunda deÄŸil?

Ã‡Ã¼nkÃ¼ tasarÄ±m ÅŸu:

* `ValidationBehavior` sadece ÅŸunu bilir:
  â€œBu request iÃ§in DI bana hangi `IValidator<TRequest>` verdiyse onlarÄ± Ã§alÄ±ÅŸtÄ±rÄ±rÄ±m.â€
* Hangi request gelirse:

  * `CreateProductCommand` â†’ `CreateProductValidator`
  * `UpdateProductCommand` â†’ `UpdateProductValidator`
  * vs.

âœ… Bu sayede yeni validator eklediÄŸinde behaviorâ€™a dokunmazsÄ±n.

---

## 5) En kÄ±sa â€œtek cÃ¼mleâ€ Ã¶zet

**CreateProductValidator, `AddValidatorsFromAssembly` ile DIâ€™a `IValidator<CreateProductCommand>` olarak kaydolduÄŸu iÃ§in; MediatR `Send(CreateProductCommand)` sÄ±rasÄ±nda `ValidationBehavior<CreateProductCommand, Guid>` oluÅŸturulurken DI tarafÄ±ndan otomatik enjekte edilir ve `ValidateAsync` ile Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r.**

---
